<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Code Review Platform - Enhanced</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      }

      .tab {
        padding: 12px 24px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1rem;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .tab.active {
        border-bottom-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .card h3 {
        margin-bottom: 15px;
        color: #fff;
      }

      .status {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: bold;
      }

      .status.healthy {
        background: #4caf50;
      }

      .status.unhealthy {
        background: #f44336;
      }

      .status.checking {
        background: #ff9800;
      }

      .code-editor {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .code-input {
        width: 100%;
        min-height: 200px;
        background: #1e1e1e;
        color: #fff;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        resize: vertical;
      }

      .language-selector {
        margin: 10px 0;
      }

      .language-selector select {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 14px;
      }

      .button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        margin: 5px;
        transition: background 0.3s ease;
      }

      .button:hover {
        background: #45a049;
      }

      .button.secondary {
        background: #2196f3;
      }

      .button.secondary:hover {
        background: #1976d2;
      }

      .button.danger {
        background: #f44336;
      }

      .button.danger:hover {
        background: #d32f2f;
      }

      .analysis-results {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .issue {
        background: rgba(244, 67, 54, 0.2);
        border-left: 4px solid #f44336;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }

      .issue.warning {
        background: rgba(255, 152, 0, 0.2);
        border-left-color: #ff9800;
      }

      .issue.style {
        background: rgba(33, 150, 243, 0.2);
        border-left-color: #2196f3;
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .metric {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .metric-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4caf50;
      }

      .metric-label {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 5px;
      }

      .projects-list {
        margin-top: 20px;
      }

      .project-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .project-info h4 {
        margin-bottom: 5px;
      }

      .project-info p {
        opacity: 0.8;
        font-size: 0.9rem;
      }

      .project-actions {
        display: flex;
        gap: 10px;
      }

      .loading {
        text-align: center;
        padding: 20px;
        opacity: 0.7;
      }

      .error {
        background: rgba(244, 67, 54, 0.2);
        border: 1px solid #f44336;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }

      .success {
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid #4caf50;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ AI Code Review Platform - Enhanced</h1>
        <p>Real-time Code Analysis and Quality Assessment</p>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
        <button class="tab" onclick="showTab('analysis')">üîç Code Analysis</button>
        <button class="tab" onclick="showTab('projects')">üìÅ Projects</button>
        <button class="tab" onclick="showTab('api')">üîå API Testing</button>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-content active">
        <div class="dashboard">
          <div class="card">
            <h3>üîß Backend API</h3>
            <p>Enhanced Analysis Service</p>
            <span id="backendStatus" class="status checking">Checking...</span>
            <div style="margin-top: 15px">
              <button class="button" onclick="checkBackend()">Check Status</button>
            </div>
          </div>

          <div class="card">
            <h3>üîç Code Analyzer</h3>
            <p>Multi-language Support</p>
            <span class="status healthy">Active</span>
            <div style="margin-top: 15px">
              <div>üêç Python: <span class="status healthy">Ready</span></div>
              <div>üìú JavaScript: <span class="status healthy">Ready</span></div>
              <div>‚òï Java: <span class="status checking">Planned</span></div>
            </div>
          </div>

          <div class="card">
            <h3>üìà Analytics</h3>
            <p>Real-time Metrics</p>
            <div style="margin-top: 15px">
              <div>Analyses Today: <strong id="analysisCount">0</strong></div>
              <div>Issues Found: <strong id="issuesCount">0</strong></div>
              <div>Projects: <strong id="projectsCount">0</strong></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Code Analysis Tab -->
      <div id="analysis" class="tab-content">
        <div class="card">
          <h3>üîç Code Analysis</h3>
          <p>Analyze your code for quality issues and metrics</p>

          <div class="code-editor">
            <div class="language-selector">
              <label>Language: </label>
              <select id="languageSelect">
                <option value="auto">Auto-detect</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
              </select>
            </div>

            <textarea
              id="codeInput"
              class="code-input"
              placeholder="Paste your code here for analysis...

Example Python code:
def hello_world():
    print('Hello, World!')
    return True

Example JavaScript code:
function helloWorld() {
    console.log('Hello, World!');
    return true;
}"
            ></textarea>

            <div style="margin-top: 15px">
              <button class="button" onclick="analyzeCode()">üîç Analyze Code</button>
              <button class="button secondary" onclick="loadExample()">üìù Load Example</button>
              <button class="button danger" onclick="clearCode()">üóëÔ∏è Clear</button>
            </div>
          </div>

          <div id="analysisResults" class="analysis-results" style="display: none">
            <!-- Results will be displayed here -->
          </div>
        </div>
      </div>

      <!-- Projects Tab -->
      <div id="projects" class="tab-content">
        <div class="card">
          <h3>üìÅ Projects</h3>
          <p>Manage your analysis projects</p>

          <div style="margin: 20px 0">
            <button class="button" onclick="createProject()">‚ûï Create Project</button>
            <button class="button secondary" onclick="loadProjects()">üîÑ Refresh</button>
          </div>

          <div id="projectsList" class="projects-list">
            <div class="loading">Loading projects...</div>
          </div>
        </div>
      </div>

      <!-- API Testing Tab -->
      <div id="api" class="tab-content">
        <div class="card">
          <h3>üîå API Testing</h3>
          <p>Test the backend API endpoints:</p>

          <div style="margin: 20px 0">
            <button class="button" onclick="testAPI('/health')">Test Health</button>
            <button class="button" onclick="testAPI('/api/status')">Test Status</button>
            <button class="button" onclick="testAPI('/api/v1/projects')">List Projects</button>
            <button class="button" onclick="testAPI('/api/v1/analysis/languages')">
              Supported Languages
            </button>
          </div>

          <div id="apiResponse" class="analysis-results" style="display: none">
            <!-- API responses will be displayed here -->
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = 'http://localhost:8001';
      let analysisCount = 0;
      let issuesCount = 0;
      let projectsCount = 0;

      // Tab management
      function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');

        // Load data for specific tabs
        if (tabName === 'projects') {
          loadProjects();
        }
      }

      // Backend status check
      async function checkBackend() {
        const status = document.getElementById('backendStatus');
        status.textContent = 'Checking...';
        status.className = 'status checking';

        try {
          const response = await fetch(`${API_BASE}/health`);
          if (response.ok) {
            status.textContent = 'Healthy';
            status.className = 'status healthy';
          } else {
            status.textContent = 'Unhealthy';
            status.className = 'status unhealthy';
          }
        } catch (error) {
          status.textContent = 'Unreachable';
          status.className = 'status unhealthy';
        }
      }

      // Code analysis
      async function analyzeCode() {
        const code = document.getElementById('codeInput').value;
        const language = document.getElementById('languageSelect').value;

        if (!code.trim()) {
          alert('Please enter some code to analyze');
          return;
        }

        const resultsDiv = document.getElementById('analysisResults');
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<div class="loading">Analyzing code...</div>';

        try {
          const response = await fetch(`${API_BASE}/api/v1/analyze/code`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              code: code,
              language: language,
            }),
          });

          const result = await response.json();
          displayAnalysisResults(result);

          // Update counters
          analysisCount++;
          if (result.issues) {
            issuesCount += result.issues.length;
          }
          updateCounters();
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">Analysis failed: ${error.message}</div>`;
        }
      }

      function displayAnalysisResults(result) {
        const resultsDiv = document.getElementById('analysisResults');

        if (result.status === 'error') {
          resultsDiv.innerHTML = `<div class="error">Analysis Error: ${result.error}</div>`;
          return;
        }

        let html = `
                <h4>üìä Analysis Results - ${result.language.toUpperCase()}</h4>
                
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value">${result.metrics.lines || 0}</div>
                        <div class="metric-label">Lines</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${result.metrics.functions || 0}</div>
                        <div class="metric-label">Functions</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${result.metrics.classes || 0}</div>
                        <div class="metric-label">Classes</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${result.metrics.complexity || 0}</div>
                        <div class="metric-label">Complexity</div>
                    </div>
                </div>
            `;

        if (result.issues && result.issues.length > 0) {
          html += '<h4>‚ö†Ô∏è Issues Found</h4>';
          result.issues.forEach(issue => {
            html += `
                        <div class="issue ${issue.type}">
                            <strong>Line ${issue.line}:</strong> ${issue.message}
                            <span style="float: right; opacity: 0.7;">${issue.severity}</span>
                        </div>
                    `;
          });
        } else {
          html += '<div class="success">‚úÖ No issues found! Code looks clean.</div>';
        }

        resultsDiv.innerHTML = html;
      }

      // Project management
      async function loadProjects() {
        const projectsDiv = document.getElementById('projectsList');
        projectsDiv.innerHTML = '<div class="loading">Loading projects...</div>';

        try {
          const response = await fetch(`${API_BASE}/api/v1/projects`);
          const projects = await response.json();

          projectsCount = projects.length;
          updateCounters();

          if (projects.length === 0) {
            projectsDiv.innerHTML = '<p>No projects found. Create your first project!</p>';
            return;
          }

          let html = '';
          projects.forEach(project => {
            html += `
                        <div class="project-item">
                            <div class="project-info">
                                <h4>${project.name}</h4>
                                <p>${project.description || 'No description'}</p>
                                <small>Status: ${project.status} | Issues: ${project.issues_count || 0}</small>
                            </div>
                            <div class="project-actions">
                                <button class="button secondary" onclick="analyzeProject(${project.id})">Analyze</button>
                            </div>
                        </div>
                    `;
          });

          projectsDiv.innerHTML = html;
        } catch (error) {
          projectsDiv.innerHTML = `<div class="error">Failed to load projects: ${error.message}</div>`;
        }
      }

      async function createProject() {
        const name = prompt('Enter project name:');
        if (!name) return;

        const description = prompt('Enter project description (optional):');

        try {
          const response = await fetch(`${API_BASE}/api/v1/projects`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              name: name,
              description: description || '',
            }),
          });

          if (response.ok) {
            alert('Project created successfully!');
            loadProjects();
          } else {
            alert('Failed to create project');
          }
        } catch (error) {
          alert(`Error: ${error.message}`);
        }
      }

      // API testing
      async function testAPI(endpoint) {
        const responseDiv = document.getElementById('apiResponse');
        responseDiv.style.display = 'block';
        responseDiv.innerHTML = '<div class="loading">Testing...</div>';

        try {
          const response = await fetch(`${API_BASE}${endpoint}`);
          const data = await response.json();

          responseDiv.innerHTML = `
                    <h4>Response from ${endpoint}</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        }
      }

      // Utility functions
      function loadExample() {
        const language = document.getElementById('languageSelect').value;
        const codeInput = document.getElementById('codeInput');

        if (language === 'python' || language === 'auto') {
          codeInput.value = `def calculate_factorial(n):
    """Calculate factorial of a number"""
    if n <= 1:
        return 1
    else:
        return n * calculate_factorial(n - 1)

def main():
    print("Factorial Calculator")
    num = 5
    result = calculate_factorial(num)
    print(f"Factorial of {num} is {result}")
    
if __name__ == "__main__":
    main()`;
        } else {
          codeInput.value = `function calculateFactorial(n) {
    // Calculate factorial of a number
    if (n <= 1) {
        return 1;
    } else {
        return n * calculateFactorial(n - 1);
    }
}

function main() {
    console.log("Factorial Calculator");
    const num = 5;
    const result = calculateFactorial(num);
    console.log(\`Factorial of \${num} is \${result}\`);
}

main();`;
        }
      }

      function clearCode() {
        document.getElementById('codeInput').value = '';
        document.getElementById('analysisResults').style.display = 'none';
      }

      function updateCounters() {
        document.getElementById('analysisCount').textContent = analysisCount;
        document.getElementById('issuesCount').textContent = issuesCount;
        document.getElementById('projectsCount').textContent = projectsCount;
      }

      // Initialize
      window.onload = function () {
        checkBackend();
        updateCounters();
      };
    </script>
  </body>
</html>
