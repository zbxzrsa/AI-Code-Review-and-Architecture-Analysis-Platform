<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Code Review Platform - Complete Frontend</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .auth-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }

      .main-content {
        display: none;
      }

      .main-content.active {
        display: block;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      }

      .tab {
        padding: 12px 24px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1rem;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .tab.active {
        border-bottom-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .card h3 {
        margin-bottom: 15px;
        color: #fff;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        color: white;
        font-size: 16px;
      }

      .form-group input::placeholder,
      .form-group textarea::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        margin: 5px;
        transition: background 0.3s ease;
      }

      .btn:hover {
        background: #45a049;
      }

      .btn.secondary {
        background: #2196f3;
      }

      .btn.secondary:hover {
        background: #1976d2;
      }

      .btn.danger {
        background: #f44336;
      }

      .btn.danger:hover {
        background: #d32f2f;
      }

      .code-editor {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .code-input {
        width: 100%;
        min-height: 300px;
        background: #1e1e1e;
        color: #fff;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        resize: vertical;
      }

      .analysis-results {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .issue {
        background: rgba(244, 67, 54, 0.2);
        border-left: 4px solid #f44336;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }

      .issue.warning {
        background: rgba(255, 152, 0, 0.2);
        border-left-color: #ff9800;
      }

      .issue.info {
        background: rgba(33, 150, 243, 0.2);
        border-left-color: #2196f3;
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .metric {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .metric-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4caf50;
      }

      .metric-label {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 5px;
      }

      .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .project-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .project-card h4 {
        margin-bottom: 10px;
        color: #4caf50;
      }

      .project-card p {
        opacity: 0.8;
        margin-bottom: 15px;
      }

      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .status.active {
        background: #4caf50;
      }

      .status.created {
        background: #2196f3;
      }

      .error {
        background: rgba(244, 67, 54, 0.2);
        border: 1px solid #f44336;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }

      .success {
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid #4caf50;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }

      .user-info {
        background: rgba(76, 175, 80, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }

      .loading {
        text-align: center;
        padding: 20px;
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ AI Code Review Platform</h1>
        <p>Complete Working Version - All Features Operational</p>
      </div>

      <!-- Authentication Section -->
      <div id="authSection" class="auth-section">
        <h3>üîê Login</h3>
        <div class="form-group">
          <label for="username">Username:</label>
          <input type="text" id="username" placeholder="Enter username" value="admin" />
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" placeholder="Enter password" value="admin123" />
        </div>
        <button class="btn" onclick="login()">üîë Login</button>
        <div id="authError" class="error" style="display: none"></div>
      </div>

      <!-- Main Content -->
      <div id="mainContent" class="main-content">
        <div class="user-info">
          <div>üë§ <span id="currentUser">Admin User</span></div>
          <button class="btn secondary" onclick="logout()">üö™ Logout</button>
        </div>

        <div class="tabs">
          <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
          <button class="tab" onclick="showTab('analysis')">üîç Code Analysis</button>
          <button class="tab" onclick="showTab('projects')">üìÅ Projects</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
          <div class="card">
            <h3>üìä Platform Status</h3>
            <div class="metrics">
              <div class="metric">
                <div class="metric-value" id="totalProjects">0</div>
                <div class="metric-label">Total Projects</div>
              </div>
              <div class="metric">
                <div class="metric-value" id="totalAnalyses">0</div>
                <div class="metric-label">Total Analyses</div>
              </div>
              <div class="metric">
                <div class="metric-value" id="totalIssues">0</div>
                <div class="metric-label">Issues Found</div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>üîß System Health</h3>
            <div id="systemStatus" class="loading">Checking system status...</div>
          </div>
        </div>

        <!-- Code Analysis Tab -->
        <div id="analysis" class="tab-content">
          <div class="card">
            <h3>üîç Code Analysis</h3>
            <div class="form-group">
              <label for="language">Language:</label>
              <select id="language">
                <option value="auto">Auto-detect</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
              </select>
            </div>
            <div class="form-group">
              <label for="codeInput">Code:</label>
              <textarea
                id="codeInput"
                class="code-input"
                placeholder="Paste your code here for analysis...

Example Python:
def calculate_factorial(n):
    if n <= 1:
        return 1
    else:
        return n * calculate_factorial(n - 1)

Example JavaScript:
function calculateFactorial(n) {
    if (n <= 1) {
        return 1;
    } else {
        return n * calculateFactorial(n - 1);
    }
}"
              ></textarea>
            </div>
            <button class="btn" onclick="analyzeCode()">üîç Analyze Code</button>
            <button class="btn secondary" onclick="loadExample()">üìù Load Example</button>
            <button class="btn danger" onclick="clearCode()">üóëÔ∏è Clear</button>
          </div>

          <div id="analysisResults" class="analysis-results" style="display: none">
            <!-- Results will be displayed here -->
          </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
          <div class="card">
            <h3>üìÅ Project Management</h3>
            <button class="btn" onclick="createProject()">‚ûï Create Project</button>
            <button class="btn secondary" onclick="loadProjects()">üîÑ Refresh</button>
          </div>

          <div id="projectsList" class="projects-grid">
            <div class="loading">Loading projects...</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = 'http://localhost:8001';
      let authToken = localStorage.getItem('authToken');
      let currentUser = null;

      // Initialize
      document.addEventListener('DOMContentLoaded', function () {
        if (authToken) {
          showMainContent();
          loadDashboard();
        } else {
          showAuthSection();
        }
      });

      function showAuthSection() {
        document.getElementById('authSection').style.display = 'block';
        document.getElementById('mainContent').classList.remove('active');
      }

      function showMainContent() {
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('mainContent').classList.add('active');
      }

      async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('authError');

        try {
          const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (response.ok) {
            authToken = data.token;
            currentUser = data.user;
            localStorage.setItem('authToken', authToken);
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainContent();
            loadDashboard();
            showSuccess('Login successful!');
          } else {
            errorDiv.textContent = data.error || 'Login failed';
            errorDiv.style.display = 'block';
          }
        } catch (error) {
          errorDiv.textContent = 'Network error: ' + error.message;
          errorDiv.style.display = 'block';
        }
      }

      function logout() {
        authToken = null;
        currentUser = null;
        localStorage.removeItem('authToken');
        localStorage.removeItem('currentUser');
        showAuthSection();
        showSuccess('Logged out successfully!');
      }

      function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');

        // Load tab-specific data
        if (tabName === 'dashboard') {
          loadDashboard();
        } else if (tabName === 'projects') {
          loadProjects();
        }
      }

      async function loadDashboard() {
        try {
          const response = await fetch(`${API_BASE}/api/status`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          if (response.ok) {
            const data = await response.json();
            updateSystemStatus(data);
          }
        } catch (error) {
          document.getElementById('systemStatus').innerHTML =
            '<div class="error">Failed to load status: ' + error.message + '</div>';
        }
      }

      function updateSystemStatus(data) {
        const statusDiv = document.getElementById('systemStatus');
        statusDiv.innerHTML = `
                <div class="success">
                    <h4>‚úÖ All Systems Operational</h4>
                    <p><strong>Status:</strong> ${data.status}</p>
                    <p><strong>Services:</strong></p>
                    <ul>
                        <li>üîß API: ${data.services?.api || 'Unknown'}</li>
                        <li>üóÑÔ∏è Database: ${data.services?.database || 'Unknown'}</li>
                        <li>üîç Analyzer: ${data.services?.analyzer || 'Unknown'}</li>
                        <li>üîê Authentication: ${data.services?.authentication || 'Unknown'}</li>
                    </ul>
                </div>
            `;
      }

      async function analyzeCode() {
        const code = document.getElementById('codeInput').value;
        const language = document.getElementById('language').value;
        const resultsDiv = document.getElementById('analysisResults');

        if (!code.trim()) {
          showError('Please enter some code to analyze');
          return;
        }

        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<div class="loading">Analyzing code...</div>';

        try {
          const response = await fetch(`${API_BASE}/api/v1/analyze/code`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ code, language }),
          });

          const data = await response.json();
          displayAnalysisResults(data);
        } catch (error) {
          resultsDiv.innerHTML = '<div class="error">Analysis failed: ' + error.message + '</div>';
        }
      }

      function displayAnalysisResults(result) {
        const resultsDiv = document.getElementById('analysisResults');

        if (result.status === 'error') {
          resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Analysis Error</h4>
                        <p>${result.error}</p>
                    </div>
                `;
          return;
        }

        let html = `
                <h4>üìä Analysis Results - ${result.language.toUpperCase()}</h4>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value">${result.lines || 0}</div>
                        <div class="metric-label">Lines</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${result.functions || 0}</div>
                        <div class="metric-label">Functions</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${result.classes || 0}</div>
                        <div class="metric-label">Classes</div>
                    </div>
                </div>
            `;

        if (result.issues && result.issues.length > 0) {
          html += '<h4>‚ö†Ô∏è Issues Found</h4>';
          result.issues.forEach(issue => {
            const issueClass =
              issue.type === 'warning' ? 'warning' : issue.type === 'info' ? 'info' : '';
            html += `
                        <div class="issue ${issueClass}">
                            <strong>Line ${issue.line || '?'}:</strong> ${issue.message}
                            <span style="float: right; opacity: 0.7;">${issue.severity || 'medium'}</span>
                        </div>
                    `;
          });
        } else {
          html += '<div class="success">‚úÖ No issues found! Code looks clean.</div>';
        }

        resultsDiv.innerHTML = html;
      }

      async function createProject() {
        const name = prompt('Enter project name:');
        if (!name) return;

        const description = prompt('Enter project description (optional):') || '';

        try {
          const response = await fetch(`${API_BASE}/api/v1/projects`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ name, description }),
          });

          if (response.ok) {
            showSuccess('Project created successfully!');
            loadProjects();
          } else {
            const data = await response.json();
            showError(data.error || 'Failed to create project');
          }
        } catch (error) {
          showError('Network error: ' + error.message);
        }
      }

      async function loadProjects() {
        const projectsDiv = document.getElementById('projectsList');
        projectsDiv.innerHTML = '<div class="loading">Loading projects...</div>';

        try {
          const response = await fetch(`${API_BASE}/api/v1/projects`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          if (response.ok) {
            const projects = await response.json();
            displayProjects(projects);
          } else {
            projectsDiv.innerHTML = '<div class="error">Failed to load projects</div>';
          }
        } catch (error) {
          projectsDiv.innerHTML = '<div class="error">Network error: ' + error.message + '</div>';
        }
      }

      function displayProjects(projects) {
        const projectsDiv = document.getElementById('projectsList');

        if (projects.length === 0) {
          projectsDiv.innerHTML = '<p>No projects found. Create your first project!</p>';
          return;
        }

        let html = '';
        projects.forEach(project => {
          const statusClass = project.status === 'active' ? 'active' : 'created';
          html += `
                    <div class="project-card">
                        <h4>${project.name}</h4>
                        <p>${project.description || 'No description'}</p>
                        <div>
                            <span class="status ${statusClass}">${project.status}</span>
                            <small style="float: right;">${new Date(project.created_at).toLocaleDateString()}</small>
                        </div>
                    </div>
                `;
        });

        projectsDiv.innerHTML = html;
      }

      function loadExample() {
        const language = document.getElementById('language').value;
        const codeInput = document.getElementById('codeInput');

        if (language === 'python' || language === 'auto') {
          codeInput.value = `def calculate_factorial(n):
    """Calculate factorial of a number recursively"""
    if n <= 1:
        return 1
    else:
        return n * calculate_factorial(n - 1)

def main():
    print("Factorial Calculator")
    for i in range(1, 6):
        result = calculate_factorial(i)
        print(f"Factorial of {i} is {result}")

if __name__ == "__main__":
    main()`;
        } else {
          codeInput.value = `function calculateFactorial(n) {
    // Calculate factorial of a number recursively
    if (n <= 1) {
        return 1;
    } else {
        return n * calculateFactorial(n - 1);
    }
}

function main() {
    console.log("Factorial Calculator");
    for (let i = 1; i <= 5; i++) {
        const result = calculateFactorial(i);
        console.log(\`Factorial of \${i} is \${result}\`);
    }
}

// Run the main function
main();`;
        }
      }

      function clearCode() {
        document.getElementById('codeInput').value = '';
        document.getElementById('analysisResults').style.display = 'none';
      }

      function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.textContent = message;
        errorDiv.style.position = 'fixed';
        errorDiv.style.top = '20px';
        errorDiv.style.right = '20px';
        errorDiv.style.zIndex = '1000';
        errorDiv.style.maxWidth = '300px';

        document.body.appendChild(errorDiv);

        setTimeout(() => {
          document.body.removeChild(errorDiv);
        }, 5000);
      }

      function showSuccess(message) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success';
        successDiv.textContent = message;
        successDiv.style.position = 'fixed';
        successDiv.style.top = '20px';
        successDiv.style.right = '20px';
        successDiv.style.zIndex = '1000';
        successDiv.style.maxWidth = '300px';

        document.body.appendChild(successDiv);

        setTimeout(() => {
          document.body.removeChild(successDiv);
        }, 3000);
      }
    </script>
  </body>
</html>
